{"version":3,"file":"index.js","mappings":"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","sources":["webpack://PServ/webpack/universalModuleDefinition","webpack://PServ/webpack/bootstrap","webpack://PServ/webpack/runtime/define property getters","webpack://PServ/webpack/runtime/hasOwnProperty shorthand","webpack://PServ/webpack/runtime/make namespace object","webpack://PServ/./src/EventTarget.ts","webpack://PServ/./src/AbstractChatClient.ts","webpack://PServ/./src/IndexedObjectCollection.ts","webpack://PServ/./src/state-tracker/AsyncUtils.ts","webpack://PServ/./src/state-tracker/MessagesManager.ts","webpack://PServ/./src/state-tracker/RoomsManager.ts","webpack://PServ/./src/state-tracker/functions.ts","webpack://PServ/./src/state-tracker/SpacesManager.ts","webpack://PServ/./src/Permissions.ts","webpack://PServ/./src/state-tracker/PermissionsManager.ts","webpack://PServ/./src/state-tracker/ChatStateTracker.ts","webpack://PServ/./src/WebSocketChatClient.ts","webpack://PServ/./src/WebApiChatClient.ts","webpack://PServ/./src/AbstractRestClient.ts","webpack://PServ/./src/AuthClient.ts","webpack://PServ/./src/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"PServ\"] = factory();\n\telse\n\t\troot[\"PServ\"] = factory();\n})(self, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export type EventHandler<EventT> = (ev?: EventT) => void;\ntype HandlersMap<EventT> = Map<string, EventHandler<EventT>[]>;\n\nexport interface ObservableInterface<EventT = any> {\n    on(eventName: string, handler: EventHandler<EventT>): this;\n    once(eventName: string, handler: EventHandler<EventT>): this;\n    off(eventName: string, handler: EventHandler<EventT>): this;\n}\n\nexport class EventTarget<EventT = any> implements ObservableInterface<EventT> {\n    protected events: HandlersMap<EventT> = new Map<string, EventHandler<EventT>[]>();\n    protected onceEvents: HandlersMap<EventT> = new Map<string, EventHandler<EventT>[]>();\n\n    public on(eventName: string, handler: EventHandler<EventT>): this {\n        this.addHandler(this.events, eventName, handler);\n        return this;\n    }\n\n    public once(eventName: string, handler: EventHandler<EventT>): this {\n        this.addHandler(this.onceEvents, eventName, handler);\n        return this;\n    }\n\n    public off(eventName: string, handler: EventHandler<EventT>): this {\n        const index = this.events.get(eventName)?.indexOf(handler);\n        if (!index || index < 0) {\n            return this;\n        }\n        this.events.get(eventName).splice(index, 1);\n    }\n\n    public emit(eventName: string, event?: EventT): this {\n        this.callHandlers(this.events, eventName, event);\n        this.callHandlers(this.onceEvents, eventName, event);\n        this.onceEvents.delete(eventName);\n        return this;\n    }\n\n    private addHandler(map: HandlersMap<EventT>, eventName: string, handler: EventHandler<EventT>): void {\n        const handlers = map.get(eventName) ?? [];\n        handlers.push(handler);\n        map.set(eventName, handlers);\n    }\n\n    private callHandlers(map: HandlersMap<EventT>, eventName: string, event: EventT): void {\n        map.get(eventName)?.forEach(callback => callback(event));\n    }\n}","import {\r\n    Bye,\r\n    GetSession,\r\n    JoinSpace,\r\n    Session,\r\n    SpaceJoined,\r\n    Error as ErrorType,\r\n    SpaceLeft,\r\n    SpaceMemberJoined,\r\n    SpaceMemberLeft,\r\n    SpaceMemberUpdated,\r\n    SpaceDeleted,\r\n    SpaceMembers,\r\n    SpaceRooms,\r\n    NewRole,\r\n    RoomDeleted,\r\n    RoomJoined,\r\n    RoomLeft,\r\n    RoomMemberLeft,\r\n    RoomMemberJoined,\r\n    RoomMembers,\r\n    NewRoom,\r\n    NewTopic,\r\n    TopicDeleted,\r\n    NewMessage,\r\n    GetPermissionOverwrites,\r\n    GetComputedPermissions,\r\n    LeaveSpace,\r\n    CreateSpace,\r\n    DeleteSpace,\r\n    GetSpaceMembers,\r\n    GetSpaceRooms,\r\n    CreateRole,\r\n    DeleteRole,\r\n    AssignRole,\r\n    DeassignRole,\r\n    SetPermissionOverwrites,\r\n    JoinRoom,\r\n    LeaveRoom,\r\n    CreateRoom,\r\n    DeleteRoom,\r\n    GetRoomMembers,\r\n    CreateTopic,\r\n    DeleteTopic,\r\n    CreateMessage,\r\n    Envelope,\r\n    PermissionOverwrites,\r\n    PermissionOverwritesUpdated,\r\n    RoomMemberUpdated,\r\n    UpdateRole,\r\n    RoleUpdated,\r\n    Ack,\r\n    UserUpdated,\r\n    UpdateRoom,\r\n    RoomUpdated,\r\n    UpdateSpace,\r\n    SpaceUpdated,\r\n    PermissionOverwriteTargets,\r\n    GetPermissionOverwriteTargets,\r\n    Owners,\r\n    Ok,\r\n    GetOwners,\r\n    CreateOwner,\r\n    RoleDeleted,\r\n    FollowedTopicUpdated,\r\n    TopicFollowed,\r\n    TopicUnfollowed,\r\n    FollowedTopics,\r\n    FollowTopic,\r\n    UnfollowTopic,\r\n    GetFollowedTopics,\r\n} from \"./types/src/index\";\r\nimport {EventTarget} from \"./EventTarget\";\r\n\r\ntype ArrayOfPromiseResolvers = [(value: any) => void, (reason?: any) => void];\r\n\r\nexport abstract class AbstractChatClient extends EventTarget {\r\n    protected awaitingResponse: Map<string, ArrayOfPromiseResolvers> = new Map<string, ArrayOfPromiseResolvers>();\r\n    protected sentCounter: number = 0;\r\n\r\n    public abstract send<CommandType extends keyof CommandsMap>\r\n        (commandType: CommandType, commandData: CommandsMap[CommandType][0]): Promise<CommandResult<CommandsMap[CommandType][1]>>;\r\n\r\n    public on<EventName extends keyof EventsMap>\r\n        (eventName: EventName | string, handler: (event: EventsMap[EventName]) => void): this {\r\n        return super.on(eventName, handler);\r\n    }\r\n\r\n    public once<EventName extends keyof EventsMap>\r\n        (eventName: EventName, handler: (event: EventsMap[EventName]) => void): this {\r\n        return super.once(eventName, handler);\r\n    }\r\n\r\n    protected createEnvelope<CommandT>(type: string, data: CommandT): Envelope<CommandT> {\r\n        return {\r\n            type, data, ref: (++this.sentCounter).toString()\r\n        };\r\n    }\r\n\r\n    protected createPromiseFromCommandEnvelope\r\n        <CommandT extends keyof CommandsMap>(envelope: Envelope<CommandsMap[CommandT][0]>):\r\n        Promise<CommandResult<CommandsMap[CommandT][1]>> {\r\n        return new Promise((...args) =>\r\n            this.awaitingResponse.set(envelope.ref as string, args));\r\n    }\r\n\r\n    protected handleIncomingEnvelope(envelope: Envelope): void {\r\n        if (!this.awaitingResponse.has(envelope.ref)) {\r\n            return;\r\n        }\r\n        const isError = envelope.type === 'Error';\r\n        this.awaitingResponse.get(envelope.ref)[0]({\r\n            data: isError ? null : envelope.data,\r\n            error: isError ? envelope.data : null,\r\n        } as CommandResult<any>);\r\n        this.awaitingResponse.delete(envelope.ref);\r\n    }\r\n\r\n    protected handleEnvelopeSendError(envelope: Envelope, error: any): void {\r\n        if (!this.awaitingResponse.has(envelope.ref)) {\r\n            return;\r\n        }\r\n        this.awaitingResponse.get(envelope.ref)[0](error);\r\n        this.awaitingResponse.delete(envelope.ref);\r\n    }\r\n}\r\n\r\nexport type CommandResult<ResultT> = {data?: ResultT, error?: Error};\r\n\r\n/**\r\n * Map of incoming events.\r\n */\r\nexport type EventsMap = {\r\n    // General Events\r\n    Bye: Bye,\r\n    Ok: Ok,\r\n    Error: ErrorType,\r\n    Session: Session,\r\n    Permissions: Permissions,\r\n    PermissionOverwrites: PermissionOverwrites,\r\n    PermissionOverwritesUpdated: PermissionOverwritesUpdated,\r\n    PermissionOverwriteTargets: PermissionOverwriteTargets,\r\n    Owners: Owners,\r\n    // Space events\r\n    SpaceJoined: SpaceJoined,\r\n    SpaceLeft: SpaceLeft,\r\n    SpaceMemberJoined: SpaceMemberJoined,\r\n    SpaceMemberLeft: SpaceMemberLeft,\r\n    SpaceMemberUpdated: SpaceMemberUpdated,\r\n    SpaceUpdated: SpaceUpdated,\r\n    SpaceDeleted: SpaceDeleted,\r\n    SpaceMembers: SpaceMembers,\r\n    SpaceRooms: SpaceRooms,\r\n    NewRole: NewRole,\r\n    RoleDeleted: RoleDeleted,\r\n    RoleUpdated: RoleUpdated,\r\n    // Room events\r\n    RoomJoined: RoomJoined,\r\n    RoomLeft: RoomLeft,\r\n    RoomMemberJoined: RoomMemberJoined,\r\n    RoomMemberLeft: RoomMemberLeft,\r\n    RoomMemberUpdated: RoomMemberUpdated,\r\n    RoomMembers: RoomMembers,\r\n    NewRoom: NewRoom,\r\n    RoomDeleted: RoomDeleted,\r\n    RoomUpdated: RoomUpdated,\r\n    // Topic events\r\n    NewTopic: NewTopic,\r\n    TopicDeleted: TopicDeleted,\r\n    NewMessage: NewMessage,\r\n    UserUpdated: UserUpdated,\r\n    TopicFollowed: TopicFollowed,\r\n    TopicUnfollowed: TopicUnfollowed,\r\n    FollowedTopics: FollowedTopics,\r\n    FollowedTopicUpdated: FollowedTopicUpdated,\r\n};\r\n\r\n/**\r\n * Map of commands and their corresponding events.\r\n */\r\nexport type CommandsMap = {\r\n    // General commands\r\n    GetSession: [GetSession, EventsMap['Session']],\r\n    SetPermissionOverwrites: [SetPermissionOverwrites, EventsMap['PermissionOverwritesUpdated']],\r\n    GetPermissionOverwrites: [GetPermissionOverwrites, EventsMap['PermissionOverwrites']],\r\n    GetComputedPermissions: [GetComputedPermissions, EventsMap['Permissions']],\r\n    GetPermissionOverwriteTargets: [GetPermissionOverwriteTargets, EventsMap['PermissionOverwriteTargets']],\r\n    GetOwners: [GetOwners, EventsMap['Owners']],\r\n    CreateOwner: [CreateOwner, EventsMap['Owners']],\r\n    DeleteOwner: [CreateOwner, EventsMap['Owners']],\r\n    // Space commands\r\n    JoinSpace: [JoinSpace, EventsMap['SpaceJoined']],\r\n    LeaveSpace: [LeaveSpace, EventsMap['SpaceLeft']],\r\n    CreateSpace: [CreateSpace, EventsMap['SpaceJoined']],\r\n    UpdateSpace: [UpdateSpace, EventsMap['SpaceUpdated']],\r\n    DeleteSpace: [DeleteSpace, EventsMap['SpaceDeleted']],\r\n    GetSpaceMembers: [GetSpaceMembers, EventsMap['SpaceMembers']],\r\n    GetSpaceRooms: [GetSpaceRooms, EventsMap['SpaceRooms']],\r\n    CreateRole: [CreateRole, EventsMap['NewRole']],\r\n    DeleteRole: [DeleteRole, EventsMap['RoleDeleted']],\r\n    UpdateRole: [UpdateRole, EventsMap['RoleUpdated']],\r\n    AssignRole: [AssignRole, EventsMap['SpaceMemberUpdated'] | EventsMap['RoomMemberUpdated']],\r\n    DeassignRole: [DeassignRole, EventsMap['SpaceMemberUpdated'] | EventsMap['RoomMemberUpdated']],\r\n    // Room commands\r\n    JoinRoom: [JoinRoom, EventsMap['RoomJoined']],\r\n    LeaveRoom: [LeaveRoom, EventsMap['RoomLeft']],\r\n    CreateRoom: [CreateRoom, EventsMap['NewRoom']],\r\n    DeleteRoom: [DeleteRoom, EventsMap['RoomDeleted']],\r\n    UpdateRoom: [UpdateRoom, EventsMap['RoomUpdated']],\r\n    GetRoomMembers: [GetRoomMembers, EventsMap['RoomMembers']],\r\n    // Topic commands\r\n    CreateTopic: [CreateTopic, EventsMap['NewTopic']],\r\n    DeleteTopic: [DeleteTopic, EventsMap['TopicDeleted']],\r\n    CreateMessage: [CreateMessage, EventsMap['NewMessage']],\r\n    Ack: [Ack, EventsMap['FollowedTopicUpdated'] | EventsMap['Ok']],\r\n    FollowTopic: [FollowTopic, EventsMap['TopicFollowed']],\r\n    UnfollowTopic: [UnfollowTopic, EventsMap['TopicUnfollowed']],\r\n    GetFollowedTopics: [GetFollowedTopics, EventsMap['FollowedTopics']],\r\n}","import {EventTarget, ObservableInterface} from \"./EventTarget\";\n\nexport class IndexedCollection<KeyT, ValueT> {\n    protected _items: Map<KeyT, ValueT> = new Map();\n\n    public constructor(items: [key: KeyT, value: ValueT][] = []) {\n        this.set(...items);\n    }\n\n    public get items(): Map<KeyT, ValueT> {\n        return this._items;\n    }\n\n    public get length(): number {\n        return this._items.size;\n    }\n\n    public set(...items: [KeyT, ValueT][]): void {\n        for (const item of items) {\n            this._items.set(item[0], item[1]);\n        }\n    }\n\n    public get(id: KeyT): ValueT | undefined {\n        return this.items.get(id);\n    }\n\n    public has(id: KeyT): boolean {\n        return this.items.has(id);\n    }\n\n    public delete(...ids: KeyT[]): void {\n        for (const id of ids) {\n            this.items.delete(id);\n        }\n    }\n\n    public deleteAll(): void {\n        this.items.clear();\n    }\n\n    public findBy(field: keyof ValueT, valueToFind: any, limit: number = null): IndexedCollection<KeyT, ValueT> {\n        const result = new IndexedCollection<KeyT, ValueT>();\n        let item;\n        while (!(item = this.items.entries().next().value).done) {\n            if (limit && result.length === limit) {\n                break;\n            }\n            if (item[1][field] === valueToFind) {\n                result.set(item);\n            }\n        }\n        return result;\n    }\n\n    public map<MapT = any>(callback: (item: ValueT, index: KeyT) => MapT): MapT[] {\n        return Array.from(this.items.entries()).map((entry) => callback(entry[1], entry[0]));\n    }\n}\n\nexport class IndexedObjectCollection<T> {\n    protected _items: IndexedCollection<string, T>;\n\n    public constructor(\n        public readonly id: keyof T | ((item: T) => any),\n        items: T[] = [],\n    ) {\n        this._items = new IndexedCollection<string, T>();\n        this.set(...items);\n    }\n\n    public get items(): T[] {\n        return Array.from(this._items.items.values());\n    }\n\n    public get length(): number {\n        return this._items.length;\n    }\n\n    public set(...items: T[]): void {\n        this._items.set(...(items.map(item => [this.getId(item), item] as [string, T])));\n    }\n\n    public get(id: any): T | undefined {\n        return this._items.get(id);\n    }\n\n    public getAt(index: number): T | undefined {\n        return this.items[index];\n    }\n\n    public has(id: any): boolean {\n        return this._items.has(id);\n    }\n\n    public delete(...ids: any[]): void {\n        this._items.delete(...ids);\n    }\n\n    public deleteAll(): void {\n        this._items.deleteAll();\n    }\n\n    public findBy(field: keyof T, valueToFind: any, limit: number = null): IndexedObjectCollection<T> {\n        const result = new IndexedObjectCollection<T>(this.id);\n        for (const value of this.items) {\n            if (limit && result.length === limit) {\n                break;\n            }\n            if (value[field] === valueToFind) {\n                result.set(value);\n            }\n        }\n        return result;\n    }\n\n    public map<MapT = any>(callback: (item: T, index: number, array: T[]) => MapT): MapT[] {\n        return this.items.map(callback);\n    }\n\n    protected getId(item: T): any {\n        return typeof this.id === 'function' ? this.id(item) : item[this.id];\n    }\n}\n\ninterface ObservableCollectionEvent<KeyT> {\n    setItems?: KeyT[],\n    deletedItems?: KeyT[],\n}\n\nexport class ObservableIndexedCollection<KeyT, ValueT> extends IndexedCollection<KeyT, ValueT> implements ObservableInterface {\n    protected eventTarget: EventTarget<ObservableCollectionEvent<KeyT>>;\n\n    public constructor(items: [key: KeyT, value: ValueT][] = []) {\n        super();\n        this.eventTarget = new EventTarget<ObservableCollectionEvent<KeyT>>();\n        this.set(...items);\n    }\n\n    public set(...items: [KeyT, ValueT][]) {\n        if (items.length) {\n            super.set(...items);\n            this.eventTarget.emit('change', {setItems: items.map(item => item[0])});\n        }\n    }\n\n    public delete(...ids: KeyT[]) {\n        if (ids.length) {\n            super.delete(...ids);\n            this.eventTarget.emit('change', {deletedItems: ids});\n        }\n    }\n\n    public deleteAll() {\n        if (this.length) {\n            const ids = this._items.keys();\n            super.deleteAll();\n            this.eventTarget.emit('change', {deletedItems: Array.from(ids)});\n        }\n    }\n\n    public on(eventName: 'change', handler: (ev?: ObservableCollectionEvent<KeyT>) => void): this {\n        this.eventTarget.on(eventName, handler);\n        return this;\n    }\n\n    public once(eventName: 'change', handler: (ev?: ObservableCollectionEvent<KeyT>) => void): this {\n        this.eventTarget.once(eventName, handler);\n        return this;\n    }\n\n    public off(eventName: string, handler: (ev?: ObservableCollectionEvent<KeyT>) => void): this {\n        this.eventTarget.off(eventName, handler);\n        return this;\n    }\n}\n\nexport class ObservableIndexedObjectCollection<T> extends IndexedObjectCollection<T> implements ObservableInterface {\n    protected eventTarget: EventTarget<ObservableCollectionEvent<string>>;\n\n    public constructor(\n        public readonly id: keyof T | ((item: T) => string),\n        items: T[] = [],\n    ) {\n        super(id);\n        this.eventTarget = new EventTarget();\n        this.set(...items);\n    }\n\n    public set(...items: T[]) {\n        if (items.length) {\n            super.set(...items);\n            this.eventTarget.emit('change', {setItems: items.map(item => this.getId(item))});\n        }\n    }\n\n    public delete(...ids: string[]) {\n        if (ids.length) {\n            super.delete(...ids);\n            this.eventTarget.emit('change', {deletedItems: ids});\n        }\n    }\n\n    public deleteAll() {\n        if (this.length) {\n            const ids = this._items.items.keys();\n            super.deleteAll();\n            this.eventTarget.emit('change', {deletedItems: Array.from(ids)});\n        }\n    }\n\n    public on(eventName: 'change', handler: (ev?: ObservableCollectionEvent<string>) => void): this {\n        this.eventTarget.on(eventName, handler);\n        return this;\n    }\n\n    public once(eventName: 'change', handler: (ev?: ObservableCollectionEvent<string>) => void): this {\n        this.eventTarget.once(eventName, handler);\n        return this;\n    }\n\n    public off(eventName: string, handler: (ev?: ObservableCollectionEvent<string>) => void): this {\n        this.eventTarget.off(eventName, handler);\n        return this;\n    }\n}","import {IndexedCollection} from \"../IndexedObjectCollection\";\r\n\r\nexport class DeferredTask {\r\n    public readonly promise: Promise<void>;\r\n    public resolve: () => void;\r\n\r\n    public constructor() {\r\n        this.promise = new Promise<void>((resolve) => this.resolve = resolve);\r\n    }\r\n}\r\n\r\nexport class PromiseRegistry {\r\n    private promises = new IndexedCollection<string, Promise<any>>();\r\n\r\n    public register<T = any>(promise: Promise<T>, key: string): void {\r\n        this.promises.set([key, promise]);\r\n    }\r\n\r\n    public registerByFunction(fn: () => Promise<any>, key: string): void {\r\n        this.register(fn(), key);\r\n    }\r\n\r\n    public get<T = any>(key: string): Promise<T> | undefined {\r\n        return this.promises.get(key);\r\n    }\r\n\r\n    public has(key: string): boolean {\r\n        return this.promises.has(key);\r\n    }\r\n\r\n    public notExist(key: string): boolean {\r\n        return ! this.has(key);\r\n    }\r\n\r\n    public forget(...keys: string[]): void {\r\n        this.promises.delete(...keys);\r\n    }\r\n}","import {ChatStateTracker} from \"./ChatStateTracker\";\r\nimport {\r\n    ChatLocation,\r\n    Message,\r\n    NewMessage,\r\n    Topic,\r\n    FollowedTopic,\r\n    TopicFollowed,\r\n    TopicUnfollowed,\r\n    RoomDeleted,\r\n    RoomLeft,\r\n    TopicDeleted,\r\n    FollowedTopicUpdated, RoomJoined, NewTopic, Session,\r\n} from \"../types/src\";\r\nimport {\r\n    IndexedCollection,\r\n    ObservableIndexedObjectCollection\r\n} from \"../IndexedObjectCollection\";\r\n\r\nexport const getCombinedId = (location: ChatLocation) => (location.roomId ?? '') + (location.topicId ?? '');\r\n\r\nexport class MessagesManager {\r\n    // Temporary not lazy loaded; server must implement GetTopicMessages command.\r\n    private readonly list = new IndexedCollection<string, ObservableIndexedObjectCollection<Message>>();\r\n    private readonly followedTopics = new IndexedCollection<string, ObservableIndexedObjectCollection<FollowedTopic>>();\r\n\r\n    public constructor(private tracker: ChatStateTracker) {\r\n        this.tracker.client.on('Session', ev => this.handleSession(ev));\r\n        this.tracker.client.on('RoomJoined', ev => this.handleRoomJoin(ev));\r\n        this.tracker.client.on('NewTopic', ev => this.handleNewTopic(ev));\r\n        this.tracker.client.on('FollowedTopicUpdated', ev => this.handleFollowedTopicUpdated(ev));\r\n        this.tracker.client.on('TopicFollowed', ev => this.handleTopicFollowed(ev));\r\n        this.tracker.client.on('TopicUnfollowed', ev => this.handleTopicUnfollowed(ev));\r\n        this.tracker.client.on('NewMessage', ev => this.handleNewMessage(ev));\r\n        this.tracker.client.on('RoomDeleted', ev => this.handleRoomDeleted(ev));\r\n        this.tracker.client.on('RoomLeft', ev => this.handleRoomLeft(ev));\r\n        this.tracker.client.on('TopicDeleted', ev => this.handleTopicDeleted(ev));\r\n    }\r\n\r\n    /**\r\n     * Get collection of the messages written in topic.\r\n     */\r\n    public async get(location: ChatLocation): Promise<ObservableIndexedObjectCollection<Message> | undefined> {\r\n        return this.list.get(getCombinedId(location));\r\n    }\r\n\r\n    /**\r\n     * Cache ack reports for all joined rooms in a space and fetch them in bulk if necessary.\r\n     * Then you can get the reports using getRoomFollowedTopics().\r\n     * @see getRoomFollowedTopics\r\n     */\r\n    public async cacheSpaceFollowedTopic(spaceId: string): Promise<void> {\r\n        if (! (await this.tracker.spaces.get()).has(spaceId)) {\r\n            throw new Error(`You are not in space ${spaceId}`);\r\n        }\r\n\r\n        // If we don't have ack reports for all rooms in space, fetch them\r\n        const result = await this.tracker.client.send('GetFollowedTopics', {location: {spaceId}});\r\n\r\n        if (result.error) {\r\n            throw result.error;\r\n        }\r\n\r\n        this.setFollowedTopicsArray(result.data.followedTopics);\r\n    }\r\n\r\n    /**\r\n     * Get ack reports for the given room. Undefined if you are not in the room.\r\n     * @param roomId\r\n     */\r\n    public async getRoomFollowedTopics(roomId: string): Promise<ObservableIndexedObjectCollection<FollowedTopic> | undefined> {\r\n        if (! (await this.tracker.rooms.get()).has(roomId)) {\r\n            return undefined;\r\n        }\r\n\r\n        if (! this.followedTopics.has(roomId)) {\r\n            const result = await this.tracker.client.send('GetFollowedTopics', {location: {roomId}});\r\n\r\n            if (result.error) {\r\n                throw result.error;\r\n            }\r\n\r\n            this.setFollowedTopicsArray(result.data.followedTopics);\r\n        }\r\n\r\n        return this.followedTopics.get(roomId);\r\n    }\r\n\r\n    /**\r\n     * For internal use. If you want to delete the message, execute a proper command on client object.\r\n     * @internal\r\n     */\r\n    public _deleteByTopicIds(roomId: string, ...topicIds: string[]): void {\r\n        this.list.delete(...topicIds.map(topicId => getCombinedId({roomId, topicId})));\r\n        this.followedTopics.get(roomId)?.delete(...topicIds);\r\n    }\r\n\r\n    private createHistoryForNewTopic(roomId: string, ...newTopics: Topic[]): void {\r\n        for (const newTopic of newTopics) {\r\n            const newTopicCombinedId = getCombinedId({roomId, topicId: newTopic.id});\r\n\r\n            this.list.set([newTopicCombinedId, new ObservableIndexedObjectCollection<Message>('id')]);\r\n\r\n            // If new topic refers to some message from this room, update other structures\r\n            if (newTopic.messageRef) {\r\n                const refTopicCombinedId = getCombinedId({roomId, topicId: newTopic.messageRef.topicId});\r\n                const refTopicMessages = this.list.get(refTopicCombinedId);\r\n                const refMessage = refTopicMessages?.get(newTopic.messageRef.messageId);\r\n\r\n                if (refMessage) {\r\n                    // Update referenced topic ID in message\r\n                    refTopicMessages.set({...refMessage, topicRef: newTopic.id});\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private handleNewMessage(ev: NewMessage): void {\r\n        this.list.get(getCombinedId(ev.location))?.set(ev.message);\r\n        this.updateLocallyFollowedTopicOnNewMessage(ev);\r\n    }\r\n\r\n    private handleFollowedTopicUpdated(ev: FollowedTopicUpdated): void {\r\n        this.followedTopics.get(ev.followedTopic.location.roomId)?.set(ev.followedTopic);\r\n    }\r\n\r\n    private handleTopicFollowed(ev: TopicFollowed): void {\r\n        this.setFollowedTopicsArray([ev.followedTopic]);\r\n    }\r\n\r\n    private handleTopicUnfollowed(ev: TopicUnfollowed): void {\r\n        this.followedTopics.get(ev.location.roomId)?.delete(ev.location.topicId);\r\n    }\r\n\r\n    private handleRoomDeleted(ev: RoomDeleted): void {\r\n        this.followedTopics.delete(ev.id);\r\n    }\r\n\r\n    private handleRoomJoin(ev: RoomJoined): void {\r\n        if (ev.room.defaultTopic) {\r\n            this.createHistoryForNewTopic(ev.room.id, ev.room.defaultTopic)\r\n        }\r\n    }\r\n\r\n    private handleRoomLeft(ev: RoomLeft): void {\r\n        this.followedTopics.delete(ev.id);\r\n    }\r\n\r\n    private async handleNewTopic(ev: NewTopic): Promise<void> {\r\n        this.createHistoryForNewTopic(ev.roomId, ev.topic);\r\n\r\n        if (this.followedTopics.has(ev.roomId)) {\r\n            // Check if the new topic is followed by user\r\n            // only if client asked for followed topics list before for this room\r\n            const result = await this.tracker.client.send(\r\n                'GetFollowedTopics',\r\n                {location: {roomId: ev.roomId, topicId: ev.topic.id}},\r\n            );\r\n            const followedTopic = result.data.followedTopics[0];\r\n            if (followedTopic) {\r\n                this.followedTopics.get(ev.roomId).set(followedTopic);\r\n            }\r\n        }\r\n    }\r\n\r\n    private handleTopicDeleted(ev: TopicDeleted): void {\r\n        this.followedTopics.get(ev.location.roomId)?.delete(ev.location.topicId);\r\n    }\r\n\r\n    private handleSession(ev: Session): void {\r\n        ev.state.rooms.forEach(room => {\r\n            if (room.defaultTopic) {\r\n                this.createHistoryForNewTopic(room.id, room.defaultTopic);\r\n            }\r\n        });\r\n    }\r\n\r\n    private updateLocallyFollowedTopicOnNewMessage(ev: NewMessage): void {\r\n        const roomFollowedTopics = this.followedTopics.get(ev.location.roomId);\r\n        const followedTopic = roomFollowedTopics.get(ev.location.topicId);\r\n\r\n        if (! roomFollowedTopics || ! followedTopic) {\r\n            // Skip if we don't follow this room or targeted topic\r\n            return;\r\n        }\r\n\r\n        const isMe = ev.message.author.id === this.tracker.me?.id;\r\n\r\n        let update: Partial<FollowedTopic>;\r\n\r\n        if (isMe) {\r\n            // Reset missed messages count if new message is authored by me\r\n            update = {missed: 0, missedMoreThan: null, lastAckMessageId: ev.message.id};\r\n        } else {\r\n            // ...add 1 otherwise\r\n            update = {\r\n                missed: followedTopic.missed === null ? null : followedTopic.missed + 1,\r\n                missedMoreThan: followedTopic.missedMoreThan === null ? null : followedTopic.missedMoreThan,\r\n            };\r\n        }\r\n\r\n        roomFollowedTopics.set({...followedTopic, ...update});\r\n    }\r\n\r\n    private setFollowedTopicsArray(followedTopics: FollowedTopic[]): void {\r\n        const roomToTopics: {[roomId: string]: FollowedTopic[]} = {};\r\n\r\n        // Reassign reports to limit collection change event emit\r\n        followedTopics.forEach(followedTopic => {\r\n            roomToTopics[followedTopic.location.roomId] ??= [];\r\n            roomToTopics[followedTopic.location.roomId].push(followedTopic);\r\n        });\r\n\r\n        for (const roomId in roomToTopics) {\r\n            if (! this.followedTopics.has(roomId)) {\r\n                this.followedTopics.set([\r\n                    roomId,\r\n                    new ObservableIndexedObjectCollection<FollowedTopic>(report => report.location.topicId),\r\n                ]);\r\n            }\r\n            this.followedTopics.get(roomId).set(...roomToTopics[roomId]);\r\n        }\r\n    }\r\n}","import {IndexedCollection, ObservableIndexedObjectCollection} from \"../IndexedObjectCollection\";\r\nimport {\r\n    NewMessage,\r\n    NewTopic,\r\n    Room, RoomDeleted,\r\n    RoomJoined, RoomLeft,\r\n    RoomMember, RoomMemberJoined, RoomMemberLeft, RoomMembers,\r\n    RoomMemberUpdated, RoomUpdated, Session, SpaceDeleted, SpaceLeft, SpaceMemberLeft,\r\n    SpaceMemberUpdated,\r\n    Topic,\r\n    TopicDeleted,\r\n    UserUpdated,\r\n} from \"../types/src\";\r\nimport {ChatStateTracker} from \"./ChatStateTracker\";\r\nimport {DeferredTask, PromiseRegistry} from \"./AsyncUtils\";\r\nimport {MessagesManager} from \"./MessagesManager\";\r\n\r\nexport class RoomsManager {\r\n    public readonly messages: MessagesManager;\r\n\r\n    private readonly list = new ObservableIndexedObjectCollection<Room>('id');\r\n    private readonly topics = new IndexedCollection<string, ObservableIndexedObjectCollection<Topic>>();\r\n    private readonly members = new IndexedCollection<string, ObservableIndexedObjectCollection<RoomMember>>();\r\n    private readonly deferredSession = new DeferredTask();\r\n    private readonly membersPromises = new PromiseRegistry();\r\n\r\n    public constructor(private tracker: ChatStateTracker) {\r\n        this.messages = new MessagesManager(tracker);\r\n\r\n        this.tracker.client.on('NewMessage', ev => this.handleNewMessage(ev));\r\n        this.tracker.client.on('NewTopic', ev => this.handleNewTopic(ev));\r\n        this.tracker.client.on('TopicDeleted', ev => this.handleTopicDeleted(ev));\r\n        this.tracker.client.on('RoomJoined', ev => this.handleRoomJoined(ev));\r\n        this.tracker.client.on('RoomLeft', ev => this.handleRoomLeft(ev));\r\n        this.tracker.client.on('RoomUpdated', ev => this.handleRoomUpdated(ev));\r\n        this.tracker.client.on('RoomDeleted', ev => this.handleRoomDeleted(ev));\r\n        this.tracker.client.on('RoomMemberJoined', ev => this.handleRoomMemberJoined(ev));\r\n        this.tracker.client.on('RoomMemberLeft', ev => this.handleRoomMemberLeft(ev));\r\n        this.tracker.client.on('RoomMembers', ev => this.handleRoomMembers(ev));\r\n        this.tracker.client.on('RoomMemberUpdated', ev => this.handleRoomMemberUpdated(ev));\r\n        this.tracker.client.on('SpaceMemberLeft', ev => this.handleSpaceMemberLeft(ev));\r\n        this.tracker.client.on('SpaceMemberUpdated', ev => this.handleSpaceMemberUpdated(ev));\r\n        this.tracker.client.on('SpaceDeleted', ev => this.handleSpaceDeleted(ev));\r\n        this.tracker.client.on('SpaceLeft', ev => this.handleSpaceDeleted(ev));\r\n        this.tracker.client.on('UserUpdated', ev => this.handleUserUpdated(ev));\r\n        this.tracker.client.on('Session', ev => this.handleSession(ev));\r\n    }\r\n\r\n    /**\r\n     * Get collection of room members.\r\n     */\r\n    public async getMembers(roomId: string): Promise<ObservableIndexedObjectCollection<RoomMember> | undefined> {\r\n        if (this.membersPromises.notExist(roomId)) {\r\n            this.membersPromises.registerByFunction(async () => {\r\n                const result = await this.tracker.client.send('GetRoomMembers', {id: roomId});\r\n                if (result.error) {\r\n                    throw result.error;\r\n                }\r\n                this.handleRoomMembers(result.data);\r\n            }, roomId);\r\n        }\r\n\r\n        await this.membersPromises.get(roomId);\r\n        return this.members.get(roomId);\r\n    }\r\n\r\n    /**\r\n     * Get a room member representing the current user.\r\n     */\r\n    public async getMe(roomId: string): Promise<RoomMember | undefined> {\r\n        const userId = (await this.tracker.getMe()).id;\r\n\r\n        if (! this.list.has(roomId)) {\r\n            // User is not in passed room.\r\n            return undefined;\r\n        }\r\n\r\n        const members = await this.getMembers(roomId);\r\n        return members.items.find(member => (member.user?.id ?? member.spaceMember.user.id) === userId);\r\n    }\r\n\r\n    /**\r\n     * Get collection of all the rooms you are in.\r\n     */\r\n    public async get(): Promise<ObservableIndexedObjectCollection<Room>> {\r\n        await this.deferredSession.promise;\r\n        return this.list;\r\n    }\r\n\r\n    /**\r\n     * Get collection of room topics.\r\n     */\r\n    public async getTopics(roomId: string): Promise<ObservableIndexedObjectCollection<Topic> | undefined> {\r\n        await this.deferredSession.promise;\r\n        return this.topics.get(roomId);\r\n    }\r\n\r\n    private deleteRoom(...roomIds: string[]): void {\r\n        this.list.delete(...roomIds);\r\n        this.members.delete(...roomIds);\r\n        this.membersPromises.forget(...roomIds);\r\n\r\n        for (const roomId of roomIds) {\r\n            const topicIds: string[] = this.topics.get(roomId)?.map(topic => topic.id) ?? [];\r\n            this.messages._deleteByTopicIds(roomId, ...topicIds);\r\n        }\r\n\r\n        this.topics.delete(...roomIds);\r\n    }\r\n\r\n    private deleteRoomsBySpaceId(spaceId: string): void {\r\n        this.deleteRoom(\r\n            ...this.list.findBy('spaceId', spaceId).map(room => room.id)\r\n        );\r\n    }\r\n\r\n    private handleSpaceMemberUpdated(ev: SpaceMemberUpdated): void {\r\n        // Update members of rooms related to this space\r\n        for (const room of this.list.findBy('spaceId', ev.spaceId).items) {\r\n            const roomMembers = this.members.get(room.id);\r\n\r\n            if (! roomMembers || ! roomMembers.has(ev.userId)) {\r\n                // Skip update if member list for this room is not loaded\r\n                // or user is not in room\r\n                continue;\r\n            }\r\n\r\n            const roomMember = roomMembers.get(ev.userId);\r\n            const user = roomMember.spaceMember.user;\r\n\r\n            // Update space member but first fill user object (it's null in event object)\r\n            roomMember.spaceMember = {...ev.member, user};\r\n            roomMembers.set(roomMember);\r\n        }\r\n    }\r\n\r\n    private handleSpaceMemberLeft(ev: SpaceMemberLeft): void {\r\n        this.list\r\n            .findBy('spaceId', ev.spaceId).items\r\n            .forEach(room => this.members.get(room.id)?.delete(ev.userId));\r\n    }\r\n\r\n    private handleRoomMemberUpdated(ev: RoomMemberUpdated): void {\r\n        if (! this.members.has(ev.roomId)) {\r\n            // We do not track member list for this room.\r\n            return;\r\n        }\r\n\r\n        const members = this.members.get(ev.roomId);\r\n        const member = members.get(ev.userId);\r\n        const newMember = ev.member;\r\n        const user = member.spaceMember?.user ?? member.user;\r\n\r\n        if (newMember.spaceMember) {\r\n            newMember.spaceMember.user = user;\r\n        } else {\r\n            newMember.user = user;\r\n        }\r\n\r\n        members.set(newMember);\r\n    }\r\n\r\n    private handleSpaceDeleted(ev: SpaceDeleted | SpaceLeft): void {\r\n        this.deleteRoomsBySpaceId(ev.id);\r\n    }\r\n\r\n    private handleTopicDeleted(ev: TopicDeleted): void {\r\n        const collection = this.topics.get(ev.location.roomId);\r\n        collection.delete(ev.location.topicId);\r\n\r\n        const room = this.list.get(ev.location.roomId);\r\n        if (room.defaultTopic?.id === ev.location.topicId) {\r\n            this.list.set({...room, defaultTopic: null});\r\n        }\r\n    }\r\n\r\n    private handleNewTopic(ev: NewTopic): void {\r\n        this.addJoinedRoomTopics(ev.roomId, ev.topic);\r\n    }\r\n\r\n    private addJoinedRoomTopics(roomId: string, ...topics: Topic[]): void {\r\n        if (this.topics.has(roomId)) {\r\n            this.topics.get(roomId).set(...topics);\r\n        } else {\r\n            this.topics.set([roomId, new ObservableIndexedObjectCollection<Topic>('id', topics)]);\r\n        }\r\n    }\r\n\r\n    private handleRoomJoined(ev: RoomJoined): void {\r\n        this.addJoinedRooms(ev.room);\r\n    }\r\n\r\n    private handleRoomUpdated(ev: RoomUpdated): void {\r\n        this.list.set({\r\n            ...this.list.get(ev.room.id),\r\n            name: ev.room.name,\r\n            description: ev.room.description,\r\n        } as Room);\r\n    }\r\n\r\n    private handleRoomDeleted(ev: RoomDeleted): void {\r\n        this.deleteRoom(ev.id);\r\n    }\r\n\r\n    private addJoinedRooms(...rooms: Room[]): void {\r\n        for (const room of rooms) {\r\n            if (room.defaultTopic) {\r\n                this.addJoinedRoomTopics(room.id, room.defaultTopic);\r\n            }\r\n        }\r\n        this.list.set(...rooms);\r\n    }\r\n\r\n    private handleRoomLeft(ev: RoomLeft): void {\r\n        this.deleteRoom(ev.id);\r\n    }\r\n\r\n    private handleRoomMemberJoined(ev: RoomMemberJoined): void {\r\n        if (this.members.has(ev.roomId)) {\r\n            this.members.get(ev.roomId).set(ev.member);\r\n        }\r\n    }\r\n\r\n    private handleRoomMemberLeft(ev: RoomMemberLeft): void {\r\n        if (this.members.has(ev.roomId)) {\r\n            this.members.get(ev.roomId).delete(ev.userId);\r\n        }\r\n    }\r\n\r\n    private handleRoomMembers(ev: RoomMembers): void {\r\n        if (! this.members.has(ev.id)) {\r\n            this.members.set([\r\n                ev.id,\r\n                new ObservableIndexedObjectCollection(\r\n                    member => member.user?.id ?? member.spaceMember.user.id,\r\n                    ev.members,\r\n                )\r\n            ]);\r\n        }\r\n    }\r\n\r\n    private handleSession(ev: Session): void {\r\n        this.list.deleteAll();\r\n        this.topics.deleteAll();\r\n        this.members.deleteAll();\r\n\r\n        this.addJoinedRooms(...ev.state.rooms);\r\n\r\n        this.deferredSession.resolve();\r\n    }\r\n\r\n    private handleUserUpdated(ev: UserUpdated): void {\r\n        this.members.items.forEach((members) => {\r\n            const member = members.get(ev.user.id);\r\n\r\n            if (! member) {\r\n                // Skip room; updated user is not here\r\n                return;\r\n            }\r\n\r\n            const newMember: RoomMember = {...member};\r\n\r\n            if (member.user) {\r\n                newMember.user = ev.user;\r\n            } else {\r\n                newMember.spaceMember.user = ev.user;\r\n            }\r\n\r\n            members.set(newMember);\r\n        });\r\n    }\r\n\r\n    private handleNewMessage(ev: NewMessage): void {\r\n        const topics = this.topics.get(ev.location.roomId);\r\n        const topic = topics.get(ev.location.topicId);\r\n\r\n        if (topic) {\r\n            topics.set({\r\n                ...topic,\r\n                messageCount: topic.messageCount + 1,\r\n                lastMessage: ev.message,\r\n            });\r\n        }\r\n    }\r\n}","import {Role} from \"../types/src\";\r\n\r\nexport function reorderRolesOnPriorityUpdate(allRoles: Role[], oldRole: Role, updatedRole: Role): Role[] {\r\n    // If the priority has changed, adjust the rest of roles\r\n    const increased = (updatedRole.priority - oldRole.priority) > 0;\r\n    const decreased = ! increased;\r\n    const changedRoles: Role[] = [];\r\n\r\n    allRoles.forEach(role => {\r\n        if (role.id === updatedRole.id) {\r\n            // Skip the updated role\r\n            return;\r\n        }\r\n        if (increased && oldRole.priority <= role.priority) {\r\n            role.priority--;\r\n            changedRoles.push(role);\r\n        }\r\n        if (decreased && updatedRole.priority <= role.priority) {\r\n            role.priority++;\r\n            changedRoles.push(role);\r\n        }\r\n    });\r\n\r\n    return changedRoles;\r\n}","import {ChatStateTracker} from \"./ChatStateTracker\";\r\nimport {IndexedCollection, ObservableIndexedObjectCollection} from \"../IndexedObjectCollection\";\r\nimport {\r\n    NewRole,\r\n    NewRoom,\r\n    Role,\r\n    RoleDeleted,\r\n    RoleUpdated,\r\n    RoomDeleted,\r\n    RoomSummary,\r\n    RoomUpdated,\r\n    Session,\r\n    Space,\r\n    SpaceDeleted,\r\n    SpaceJoined,\r\n    SpaceLeft,\r\n    SpaceMember,\r\n    SpaceMemberJoined,\r\n    SpaceMemberLeft,\r\n    SpaceMembers,\r\n    SpaceMemberUpdated,\r\n    SpaceRooms,\r\n    SpaceUpdated,\r\n    UserUpdated\r\n} from \"../types/src\";\r\nimport {DeferredTask, PromiseRegistry} from \"./AsyncUtils\";\r\nimport {reorderRolesOnPriorityUpdate} from \"./functions\";\r\n\r\nexport class SpacesManager {\r\n    private readonly list = new ObservableIndexedObjectCollection<Space>('id');\r\n    private readonly roles = new IndexedCollection<string, ObservableIndexedObjectCollection<Role>>();\r\n    private readonly rooms = new IndexedCollection<string, ObservableIndexedObjectCollection<RoomSummary>>();\r\n    private readonly roomIdToSpaceId = new IndexedCollection<string, string>();\r\n    private readonly members = new IndexedCollection<string, ObservableIndexedObjectCollection<SpaceMember>>();\r\n    private readonly deferredSession = new DeferredTask();\r\n    private readonly roomsPromises = new PromiseRegistry();\r\n    private readonly membersPromises = new PromiseRegistry();\r\n\r\n    public constructor(private tracker: ChatStateTracker) {\r\n        this.tracker.client.on('NewRoom', ev => this.handleNewRoom(ev));\r\n        this.tracker.client.on('RoomDeleted', ev => this.handleRoomDeleted(ev));\r\n        this.tracker.client.on('RoomUpdated', ev => this.handleRoomUpdated(ev));\r\n        this.tracker.client.on('SpaceDeleted', ev => this.handleSpaceDeleted(ev));\r\n        this.tracker.client.on('SpaceUpdated', ev => this.handleSpaceUpdated(ev));\r\n        this.tracker.client.on('SpaceJoined', ev => this.handleSpaceJoined(ev));\r\n        this.tracker.client.on('SpaceLeft', ev => this.handleSpaceDeleted(ev));\r\n        this.tracker.client.on('SpaceMemberJoined', ev => this.handleSpaceMemberJoined(ev));\r\n        this.tracker.client.on('SpaceMemberLeft', ev => this.handleSpaceMemberLeft(ev));\r\n        this.tracker.client.on('SpaceMembers', ev => this.handleSpaceMembers(ev));\r\n        this.tracker.client.on('SpaceRooms', ev => this.handleSpaceRooms(ev));\r\n        this.tracker.client.on('SpaceMemberUpdated', ev => this.handleSpaceMemberUpdated(ev));\r\n        this.tracker.client.on('UserUpdated', ev => this.handleUserUpdated(ev));\r\n        this.tracker.client.on('NewRole', ev => this.handleNewRole(ev));\r\n        this.tracker.client.on('RoleDeleted', ev => this.handleRoleDeleted(ev));\r\n        this.tracker.client.on('RoleUpdated', ev => this.handleRoleUpdated(ev));\r\n        this.tracker.client.on('Session', ev => this.handleSession(ev));\r\n    }\r\n\r\n    /**\r\n     * Get collection of all the spaces you are in.\r\n     */\r\n    public async get(): Promise<ObservableIndexedObjectCollection<Space>> {\r\n        await this.deferredSession.promise;\r\n        return this.list;\r\n    }\r\n\r\n    /**\r\n     * Get collection of space roles.\r\n     */\r\n    public async getRoles(spaceId: string): Promise<ObservableIndexedObjectCollection<Role> | undefined> {\r\n        await this.deferredSession.promise;\r\n        return this.roles.get(spaceId);\r\n    }\r\n\r\n    /**\r\n     * Get collection of the all available rooms inside given space.\r\n     */\r\n    public async getRooms(spaceId: string): Promise<ObservableIndexedObjectCollection<RoomSummary> | undefined> {\r\n        if (this.roomsPromises.notExist(spaceId)) {\r\n            this.roomsPromises.registerByFunction(async () => {\r\n                const result = await this.tracker.client.send('GetSpaceRooms', {id: spaceId});\r\n                if (result.error) {\r\n                    throw result.error;\r\n                }\r\n                this.handleSpaceRooms(result.data);\r\n            }, spaceId);\r\n        }\r\n\r\n        await this.roomsPromises.get(spaceId);\r\n        return this.rooms.get(spaceId);\r\n    }\r\n\r\n    /**\r\n     * Get collection of space members.\r\n     */\r\n    public async getMembers(spaceId: string): Promise<ObservableIndexedObjectCollection<SpaceMember> | undefined> {\r\n        if (this.membersPromises.notExist(spaceId)) {\r\n            this.membersPromises.registerByFunction(async () => {\r\n                const result = await this.tracker.client.send('GetSpaceMembers', {id: spaceId});\r\n                if (result.error) {\r\n                    throw result.error;\r\n                }\r\n                this.handleSpaceMembers(result.data);\r\n            }, spaceId);\r\n        }\r\n\r\n        await this.membersPromises.get(spaceId);\r\n        return this.members.get(spaceId);\r\n    }\r\n\r\n    /**\r\n     * Get a space member representing the current user.\r\n     */\r\n    public async getMe(spaceId: string): Promise<SpaceMember | undefined> {\r\n        const userId = (await this.tracker.getMe()).id;\r\n\r\n        if (! this.list.has(spaceId)) {\r\n            // User is not in passed space.\r\n            return undefined;\r\n        }\r\n\r\n        const members = await this.getMembers(spaceId);\r\n        return members.items.find(member => member.user.id === userId);\r\n    }\r\n\r\n    private handleNewRole(ev: NewRole): void {\r\n        const collection = this.roles.get(ev.spaceId);\r\n        collection.set(ev.role);\r\n        this.list.get(ev.spaceId).roles = collection.items;\r\n    }\r\n\r\n    private handleNewRoom(ev: NewRoom): void {\r\n        this.rooms.get(ev.spaceId)?.set(ev.summary);\r\n        this.roomIdToSpaceId.set([ev.summary.id, ev.spaceId]);\r\n    }\r\n\r\n    private handleRoomUpdated(ev: RoomUpdated): void {\r\n        if (ev.room.spaceId && this.rooms.has(ev.room.spaceId)) {\r\n            const rooms = this.rooms.get(ev.room.spaceId);\r\n            rooms.set({\r\n                ...rooms.get(ev.room.id),\r\n                name: ev.room.name,\r\n                description: ev.room.description,\r\n            } as RoomSummary);\r\n        }\r\n    }\r\n\r\n    private async handleRoomDeleted(ev: RoomDeleted): Promise<void> {\r\n        const spaceId = this.roomIdToSpaceId.get(ev.id);\r\n\r\n        if (spaceId && this.rooms.has(spaceId)) {\r\n            this.rooms.get(spaceId).delete(ev.id);\r\n        }\r\n    }\r\n\r\n    private handleRoleDeleted(ev: RoleDeleted): void {\r\n        const collection = this.roles.get(ev.spaceId);\r\n        collection.delete(ev.id);\r\n        this.list.get(ev.spaceId).roles = collection.items;\r\n    }\r\n\r\n    private handleSpaceUpdated(ev: SpaceUpdated): void {\r\n        this.list.set({\r\n            ...this.list.get(ev.space.id),\r\n            name: ev.space.name,\r\n        } as Space);\r\n    }\r\n\r\n    private handleSpaceDeleted(ev: SpaceDeleted | SpaceLeft): void {\r\n        const roomIds = this.rooms.get(ev.id)?.map(item => item.id) ?? [];\r\n        this.roomIdToSpaceId.delete(...roomIds);\r\n\r\n        this.roles.delete(ev.id);\r\n        this.members.delete(ev.id);\r\n        this.membersPromises.forget(ev.id);\r\n        this.rooms.delete(ev.id);\r\n        this.roomsPromises.forget(ev.id);\r\n        this.list.delete(ev.id);\r\n    }\r\n\r\n    private handleSpaceJoined(ev: SpaceJoined): void {\r\n        this.addJoinedSpaces(ev.space);\r\n    }\r\n\r\n    private addJoinedSpaces(...spaces: Space[]): void {\r\n        this.roles.set(...(spaces.map(space => [\r\n            space.id,\r\n            new ObservableIndexedObjectCollection<Role>('id', space.roles)\r\n        ]) as [string, ObservableIndexedObjectCollection<Role>][]));\r\n        this.list.set(...spaces);\r\n    }\r\n\r\n    private handleSpaceMemberJoined(ev: SpaceMemberJoined): void {\r\n        if (this.members.has(ev.spaceId)) {\r\n            this.members.get(ev.spaceId).set(ev.member);\r\n        }\r\n    }\r\n\r\n    private handleSpaceMemberLeft(ev: SpaceMemberLeft): void {\r\n        if (this.members.has(ev.spaceId)) {\r\n            this.members.get(ev.spaceId).delete(ev.userId);\r\n        }\r\n    }\r\n\r\n    private handleSpaceMembers(ev: SpaceMembers): void {\r\n        if (! this.members.has(ev.id)) {\r\n            this.members.set([\r\n                ev.id,\r\n                new ObservableIndexedObjectCollection(member => member?.user.id, ev.members)\r\n            ]);\r\n        }\r\n    }\r\n\r\n    private handleSpaceRooms(ev: SpaceRooms): void {\r\n        if (! this.rooms.has(ev.id)) {\r\n            this.rooms.set([ev.id, new ObservableIndexedObjectCollection('id', ev.summaries)]);\r\n        }\r\n    }\r\n\r\n    private handleSpaceMemberUpdated(ev: SpaceMemberUpdated): void {\r\n        if (this.members.has(ev.spaceId)) {\r\n            const members = this.members.get(ev.spaceId);\r\n            const member = members.get(ev.userId);\r\n            members.set({...ev.member, user: member.user});\r\n        }\r\n    }\r\n\r\n    private handleRoleUpdated(ev: RoleUpdated): void {\r\n        const roles = this.roles.get(ev.spaceId);\r\n        const oldRole = roles.get(ev.role.id);\r\n        const newRole = ev.role;\r\n        const rolesToUpdate = [newRole];\r\n\r\n        if (oldRole.priority !== newRole.priority) {\r\n            rolesToUpdate.push(\r\n                ...reorderRolesOnPriorityUpdate(roles.items, oldRole, newRole)\r\n            );\r\n        }\r\n\r\n        this.roles.get(ev.spaceId).set(...rolesToUpdate);\r\n    }\r\n\r\n    private handleSession(ev: Session): void {\r\n        this.list.deleteAll();\r\n        this.roles.deleteAll();\r\n        this.rooms.deleteAll();\r\n        this.members.deleteAll();\r\n        this.roomIdToSpaceId.deleteAll();\r\n\r\n        this.addJoinedSpaces(...ev.state.spaces);\r\n\r\n        this.deferredSession.resolve();\r\n    }\r\n\r\n    private handleUserUpdated(ev: UserUpdated): void {\r\n        this.members.items.forEach((members) => {\r\n            const member = members.get(ev.user.id);\r\n\r\n            if (! member) {\r\n                // Skip space; updated user is not here\r\n                return;\r\n            }\r\n\r\n            members.set({...member, user: ev.user});\r\n        });\r\n    }\r\n}","export enum Layer {\r\n    Global,\r\n    Space,\r\n    Room,\r\n    Topic,\r\n}\r\n\r\nexport class PermissionDefinition {\r\n    value: number;\r\n    maxLayer: Layer;\r\n}\r\n\r\nexport class Permissions {\r\n    public static readonly list = {\r\n        Root: {value: 1 << 0, maxLayer: Layer.Room},\r\n        CreateSpaces: {value: 1 << 1, maxLayer: Layer.Global},\r\n        ManageSpace: {value: 1 << 2, maxLayer: Layer.Space},\r\n        ManageSpaceRoles: {value: 1 << 3, maxLayer: Layer.Space},\r\n        ManageRoom: {value: 1 << 4, maxLayer: Layer.Room},\r\n        CreateTopics: {value: 1 << 5, maxLayer: Layer.Room},\r\n        ManageTopic: {value: 1 << 6, maxLayer: Layer.Topic},\r\n        ManageSpaceMembers: {value: 1 << 7, maxLayer: Layer.Space},\r\n        ManageRoomMembers: {value: 1 << 8, maxLayer: Layer.Room},\r\n        CreateMessages: {value: 1 << 9, maxLayer: Layer.Topic},\r\n        ManagePermissions: {value: 1 << 10, maxLayer: Layer.Topic},\r\n        CreateSpaceRooms: {value: 1 << 11, maxLayer: Layer.Space},\r\n        ManageSpaceRooms: {value: 1 << 12, maxLayer: Layer.Space},\r\n    };\r\n\r\n    public static getNames(): (keyof typeof this.list)[] {\r\n        return Object.keys(this.list) as any;\r\n    }\r\n\r\n    public static getByName(name: keyof typeof this.list): PermissionDefinition | undefined {\r\n        return this.list[name];\r\n    }\r\n\r\n    public static canBeDefinedOnLayer(permissionName: keyof typeof this.list, layer: Layer): boolean {\r\n        const def = this.getByName(permissionName);\r\n\r\n        if (! def) {\r\n            throw new Error(`Invalid permission name: ${permissionName}`);\r\n        }\r\n\r\n        return layer <= this.getByName(permissionName).maxLayer;\r\n    }\r\n}","import {ChatStateTracker} from \"./ChatStateTracker\";\r\nimport {\r\n    ChatLocation,\r\n    PermissionOverwrites,\r\n    PermissionOverwritesUpdated,\r\n    PermissionOverwritesValue,\r\n    RoleDeleted,\r\n    RoomDeleted,\r\n    RoomLeft, RoomMember, RoomMemberUpdated,\r\n    SpaceDeleted,\r\n    SpaceLeft, SpaceMember,\r\n    SpaceMemberUpdated,\r\n    TopicDeleted,\r\n} from \"../types/src\";\r\nimport {EventHandler, EventTarget} from \"../EventTarget\";\r\nimport {IndexedCollection} from \"../IndexedObjectCollection\";\r\nimport {Permissions} from \"../Permissions\";\r\nimport {PromiseRegistry} from \"./AsyncUtils\";\r\n\r\nconst getOvId = (\r\n    location: ChatLocation,\r\n    target?: PermissionOverwrites['target'],\r\n    targetId?: PermissionOverwrites['targetId'],\r\n) => (location.spaceId ?? '') + (location.roomId ?? '') + (location.topicId ?? '') + (target ?? '') + (targetId ?? '');\r\n\r\nconst getOvIdByObject = (overwrites: PermissionOverwrites | PermissionOverwritesUpdated): string => getOvId(\r\n    overwrites.location, overwrites.target, overwrites.targetId\r\n);\r\n\r\ninterface CheckPermissionsResult {\r\n    /**\r\n     * @deprecated Use `hasAll` instead.\r\n     */\r\n    ok: boolean;\r\n    hasAll: boolean;\r\n    hasAny: boolean;\r\n    missing: string[];\r\n}\r\n\r\nexport class PermissionsManager extends EventTarget {\r\n    private readonly overwrites = new IndexedCollection<string, PermissionOverwrites>();\r\n    private readonly overwritesPromises = new PromiseRegistry();\r\n\r\n    public constructor(private tracker: ChatStateTracker) {\r\n        super();\r\n        this.tracker.client.on('PermissionOverwrites', ev => this.handlePermissionOverwrites(ev));\r\n        this.tracker.client.on('PermissionOverwritesUpdated', ev => this.handlePermissionOverwrites(ev));\r\n        this.tracker.client.on('SpaceDeleted', ev => this.handleSpaceDeleted(ev));\r\n        this.tracker.client.on('SpaceLeft', ev => this.handleSpaceDeleted(ev));\r\n        this.tracker.client.on('RoomDeleted', ev => this.handleRoomDeleted(ev));\r\n        this.tracker.client.on('RoomLeft', ev => this.handleRoomDeleted(ev));\r\n        this.tracker.client.on('TopicDeleted', ev => this.handleTopicDeleted(ev));\r\n        this.tracker.client.on('RoleDeleted', ev => this.handleRoleDeleted(ev));\r\n        this.tracker.client.on('SpaceMemberUpdated', ev => this.handleSpaceMemberUpdated(ev));\r\n        this.tracker.client.on('RoomMemberUpdated', ev => this.handleRoomMemberUpdated(ev));\r\n    }\r\n\r\n    public async getOverwrites(\r\n        location: ChatLocation,\r\n        target: PermissionOverwrites['target'],\r\n        targetId: PermissionOverwrites['targetId'],\r\n    ): Promise<PermissionOverwrites | undefined> {\r\n        this.validateLocation(location);\r\n\r\n        const id = getOvId(location, target, targetId);\r\n\r\n        if (this.overwritesPromises.notExist(id)) {\r\n            this.overwritesPromises.registerByFunction(async () => {\r\n                const result = await this.tracker.client.send(\r\n                    'GetPermissionOverwrites',\r\n                    {location, target, targetId},\r\n                );\r\n                if (result.error) {\r\n                    throw result.error;\r\n                }\r\n                this.handlePermissionOverwrites(result.data);\r\n            }, id);\r\n        }\r\n\r\n        await this.overwritesPromises.get(id);\r\n        return this.overwrites.get(id);\r\n    }\r\n\r\n    public on(eventName: 'change', handler: EventHandler<any>): this {\r\n        return super.on(eventName, handler);\r\n    }\r\n\r\n    public async check(\r\n        permissionNames: (keyof typeof Permissions.list)[],\r\n        location: ChatLocation,\r\n    ): Promise<CheckPermissionsResult> {\r\n        if (! permissionNames.length) {\r\n            throw new Error('Permission names array cannot be empty');\r\n        }\r\n\r\n        const ownedPermissions = await this.calculatePermissions(location);\r\n        const missing: string[] = [];\r\n\r\n        permissionNames.forEach(name => {\r\n            if (~ ownedPermissions & Permissions.getByName(name).value) {\r\n                missing.push(name as string);\r\n            }\r\n        });\r\n\r\n        return {\r\n            ok: missing.length === 0,\r\n            hasAll: missing.length === 0,\r\n            hasAny: missing.length < permissionNames.length,\r\n            missing,\r\n        };\r\n    }\r\n\r\n    public async calculatePermissions(location: ChatLocation): Promise<number> {\r\n        this.validateLocation(location);\r\n\r\n        const userId = (await this.tracker.getMe()).id;\r\n        const [spaceMember, roomMember] = await this.fetchMembersOrFail(location);\r\n        const userRoles: string[] = [...(spaceMember?.roles ?? []), ...(roomMember?.roles ?? [])];\r\n        const promises: Promise<PermissionOverwritesValue>[] = [\r\n            // Global user overwrites\r\n            this.getOverwrites({}, 'User', userId).then(v => v.overwrites),\r\n        ];\r\n\r\n        if (location.spaceId && (await this.tracker.spaces.get())?.has(location.spaceId)) {\r\n            const filterLocation: ChatLocation = {spaceId: location.spaceId};\r\n            promises.push(this.collectRoleOverwrites(filterLocation, userRoles));\r\n            promises.push(this.getOverwrites(filterLocation, 'User', userId).then(v => v.overwrites));\r\n        }\r\n\r\n        if (location.roomId && (await this.tracker.rooms.get())?.has(location.roomId)) {\r\n            const filterLocation: ChatLocation = {spaceId: location.spaceId, roomId: location.roomId};\r\n            if (userRoles.length) {\r\n                promises.push(this.collectRoleOverwrites(filterLocation, userRoles));\r\n            }\r\n            promises.push(this.getOverwrites(filterLocation, 'User', userId).then(v => v.overwrites));\r\n        }\r\n\r\n        if (location.topicId && (await this.tracker.rooms.getTopics(location.roomId))?.has(location.topicId)) {\r\n            if (userRoles.length) {\r\n                promises.push(this.collectRoleOverwrites(location, userRoles));\r\n            }\r\n            promises.push(this.getOverwrites(location, 'User', userId).then(v => v.overwrites));\r\n        }\r\n\r\n        return this.resolveOverwritesHierarchy(await Promise.all(promises));\r\n    }\r\n\r\n    private handlePermissionOverwrites(ev: PermissionOverwritesUpdated | PermissionOverwrites): void {\r\n        this.overwrites.set([getOvIdByObject(ev), ev]);\r\n        this.emit('change');\r\n    }\r\n\r\n    private handleSpaceDeleted(ev: SpaceDeleted | SpaceLeft): void {\r\n        const ids = this.deleteOverwritesByIdPrefix(getOvId({spaceId: ev.id}));\r\n        this.overwritesPromises.forget(...ids);\r\n    }\r\n\r\n    private async handleRoomDeleted(ev: RoomDeleted | RoomLeft): Promise<void> {\r\n        const room = (await this.tracker.rooms.get()).get(ev.id);\r\n        if (room) {\r\n            const ids = this.deleteOverwritesByIdPrefix(getOvId({spaceId: room.spaceId, roomId: room.id}));\r\n            this.overwritesPromises.forget(...ids);\r\n        }\r\n    }\r\n\r\n    private handleTopicDeleted(ev: TopicDeleted): void {\r\n        const ids = this.deleteOverwritesByIdPrefix(getOvId(ev.location));\r\n        this.overwritesPromises.forget(...ids);\r\n    }\r\n\r\n    private handleRoleDeleted(ev: RoleDeleted): void {\r\n        const ids = this.deleteOverwritesByIdPrefix(getOvId({spaceId: ev.spaceId}, 'Role', ev.id));\r\n        this.overwritesPromises.forget(...ids);\r\n    }\r\n\r\n    private handleSpaceMemberUpdated(ev: SpaceMemberUpdated): void {\r\n        if (ev.userId === this.tracker.me?.id) {\r\n            // User roles in space could potentially have changed\r\n            this.emit('change');\r\n        }\r\n    }\r\n\r\n    private handleRoomMemberUpdated(ev: RoomMemberUpdated): void {\r\n        if (ev.userId === this.tracker.me?.id) {\r\n            // User roles in room could potentially have changed\r\n            this.emit('change');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @return Matched and deleted ids\r\n     */\r\n    private deleteOverwritesByIdPrefix(prefix: string): string[] {\r\n        const ids: string[] = [];\r\n        this.overwrites.items.forEach((overwrites) => {\r\n            const id = getOvIdByObject(overwrites);\r\n            if (id.startsWith(prefix)) {\r\n                ids.push(id);\r\n                this.overwrites.delete(id);\r\n            }\r\n        });\r\n        return ids;\r\n    }\r\n\r\n    private async collectRoleOverwrites(\r\n        location: ChatLocation,\r\n        userRoles: string[],\r\n    ): Promise<PermissionOverwritesValue> {\r\n        const roleOverwrites = await Promise.all(userRoles.map(\r\n            roleId => this.getOverwrites(location, 'Role', roleId)\r\n        ));\r\n\r\n        return this.resolveOverwritesFromRolesByOrder(location.spaceId, roleOverwrites);\r\n    }\r\n\r\n    private async resolveOverwritesFromRolesByOrder(\r\n        spaceId: string,\r\n        overwrites: PermissionOverwrites[],\r\n    ): Promise<PermissionOverwritesValue> {\r\n        let allows = 0, denies = 0;\r\n        const roles = await this.tracker.spaces.getRoles(spaceId);\r\n        const sortedOverwrites = overwrites.sort(\r\n            (a, b) =>\r\n                roles.get(a.targetId).priority - roles.get(b.targetId).priority\r\n        );\r\n\r\n        // Max length of bit word\r\n        const permissionsLength = overwrites.reduce(\r\n            (previousValue: number, currentValue: PermissionOverwrites) =>\r\n                Math.max(\r\n                    previousValue,\r\n                    currentValue.overwrites.allow?.toString(2).length ?? 0,\r\n                    currentValue.overwrites.deny?.toString(2).length ?? 0,\r\n                ),\r\n            0,\r\n        );\r\n\r\n        sortedOverwrites.forEach(overwriteEvent => {\r\n            const overwrites = overwriteEvent.overwrites;\r\n            const revDecDenies = overwrites.deny?.toString(2).split('').reverse().join('') ?? '';\r\n            const revDecAllows = overwrites.allow?.toString(2).split('').reverse().join('') ?? '';\r\n\r\n            for (let i = 0; i < permissionsLength; i++) {\r\n                const deny = parseInt(revDecDenies[i] ?? '0');\r\n                const allow = parseInt(revDecAllows[i] ?? '0');\r\n\r\n                if (deny) {\r\n                    denies |= 1 << i;\r\n                }\r\n\r\n                if (allow) {\r\n                    allows |= 1 << i;\r\n                }\r\n            }\r\n        });\r\n\r\n        return {allow: allows, deny: denies};\r\n    }\r\n\r\n    private resolveOverwritesHierarchy(permissionOverwritesValues: PermissionOverwritesValue[]): number {\r\n        let result = 0;\r\n\r\n        for (const value of permissionOverwritesValues) {\r\n            if (value.allow & Permissions.getByName('Root').value) {\r\n                return this.getRootAccessValue();\r\n            }\r\n\r\n            result = (result & ~value.deny) | value.allow;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private getRootAccessValue(): number {\r\n        let result = 0;\r\n\r\n        for (const name of Permissions.getNames()) {\r\n            result |= Permissions.getByName(name).value;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private async fetchMembersOrFail(location: ChatLocation): Promise<[SpaceMember | null, RoomMember | null]> {\r\n        const results = await Promise.all([\r\n            location.spaceId ? this.tracker.spaces.getMe(location.spaceId) : null,\r\n            location.roomId ? this.tracker.rooms.getMe(location.roomId) : null,\r\n        ]);\r\n\r\n        const spaceFail = location.spaceId && ! results[0];\r\n        const roomFail = location.roomId && ! results[1];\r\n\r\n        if (spaceFail || roomFail) {\r\n            const layer = spaceFail ? `space (${location.spaceId})` : `room (${location.roomId})`;\r\n            throw new Error(`Attempting to calculate permissions for a ${layer} that the user does not belong to`);\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    private validateLocation(location: ChatLocation): void {\r\n        if (location.topicId && ! location.roomId) {\r\n            throw new Error('Corrupted arguments hierarchy');\r\n        }\r\n    }\r\n}","import {WebSocketChatClient} from \"../WebSocketChatClient\";\nimport {Session, User} from \"../types/src\";\nimport {RoomsManager} from \"./RoomsManager\";\nimport {SpacesManager} from \"./SpacesManager\";\nimport {PermissionsManager} from \"./PermissionsManager\";\nimport {DeferredTask} from \"./AsyncUtils\";\n\nexport class ChatStateTracker {\n    /**\n     * State of your permissions.\n     */\n    public readonly permissions = new PermissionsManager(this);\n    /**\n     * State of the rooms you are in.\n     */\n    public readonly rooms: RoomsManager = new RoomsManager(this);\n    /**\n     * State of the spaces you are in.\n     */\n    public readonly spaces = new SpacesManager(this);\n\n    private _me: User = null;\n    private readonly deferredSession = new DeferredTask();\n\n    public constructor(public readonly client: WebSocketChatClient) {\n        this.client.on('Session', ev => this.handleSession(ev));\n    }\n\n    public get me(): User | null {\n        return this._me;\n    }\n\n    public async getMe(): Promise<User> {\n        await this.deferredSession.promise;\n        return this._me;\n    }\n\n    private handleSession(ev: Session): void {\n        this._me = ev.user;\n        this.deferredSession.resolve();\n    }\n}","import {ObservableInterface} from \"./EventTarget\";\nimport {AbstractChatClient, CommandResult, CommandsMap} from \"./AbstractChatClient\";\nimport {ChatStateTracker} from \"./state-tracker/ChatStateTracker\";\nimport {Envelope} from \"./types/src\";\n\nexport interface WebSocketClientOptions {\n    url: string;\n    token?: string;\n    temporaryNick?: string;\n    connectingTimeoutMs?: number;\n    awaitQueueSendDelayMs?: number;\n    stateTracking?: boolean;\n}\n\nenum WebSocketChatClientEvent {\n    connect = 'connect',\n    disconnect = 'disconnect',\n    message = 'message',\n    error = 'error',\n}\n\nexport class WebSocketChatClient extends AbstractChatClient implements ObservableInterface {\n    public readonly Event = WebSocketChatClientEvent;\n    public readonly state?: ChatStateTracker;\n\n    protected ws: WebSocket|null = null;\n    protected sendQueue: [commandType: keyof CommandsMap, commandData: any][] = [];\n    protected connectingTimeoutId: any;\n    protected authenticated: boolean;\n    protected authenticatedResolvers: [() => void, (error: Error) => void];\n\n    public constructor(private readonly options: WebSocketClientOptions) {\n        super();\n        if (!this.options.token && !this.options.temporaryNick) {\n            throw new Error('Token or temporary nick is required');\n        }\n        if (this.options.stateTracking ?? true) {\n            this.state = new ChatStateTracker(this);\n        }\n    }\n\n    public async connect(): Promise<void> {\n        const authString = this.options.token ? `token=${this.options.token}` : `nick=${this.options.temporaryNick}`;\n        this.ws = new WebSocket(`${this.options.url}?${authString}`);\n        this.ws.onclose = ev => this.onClose(ev);\n        this.ws.onmessage = ev => this.onMessage(ev);\n        this.connectingTimeoutId = setTimeout(\n            () => this.triggerConnectionTimeout(),\n            this.options.connectingTimeoutMs ?? 10000\n        );\n        this.authenticated = false;\n        return new Promise((...args) => this.authenticatedResolvers = args);\n    }\n\n    public disconnect(): void {\n        this.sendQueue = [];\n        this.ws?.close();\n        this.ws = null;\n    }\n\n    public async send<CommandType extends keyof CommandsMap>(commandType: CommandType, commandData: CommandsMap[CommandType][0]):\n       Promise<CommandResult<CommandsMap[CommandType][1]>> {\n        if (!this.ws || [this.ws.CLOSED, this.ws.CLOSING].includes(this.ws.readyState)) {\n            throw new Error('Cannot send; close or closing connection state');\n        }\n\n        if (this.ws.readyState === this.ws.CONNECTING || !this.authenticated) {\n            this.sendQueue.push([commandType, commandData] as any);\n            return;\n        }\n\n        if (this.ws.readyState !== this.ws.OPEN) {\n            throw new Error(`Invalid websocket state=${this.ws.readyState}`);\n        }\n\n        const envelope = this.createEnvelope<CommandsMap[CommandType][0]>(commandType, commandData);\n        this.ws.send(JSON.stringify(envelope));\n        return this.createPromiseFromCommandEnvelope<CommandType>(envelope);\n    }\n\n    private onMessage(event: MessageEvent): void {\n        const envelope: Envelope = JSON.parse(event.data);\n        this.handleIncomingEnvelope(envelope);\n        this.emit(envelope.type, envelope.data);\n        this.emit(this.Event.message, envelope);\n\n        // Login successfully\n        if (!this.authenticated) {\n            const isAuthenticated = envelope.type !== 'Error';\n            this.authenticated = isAuthenticated;\n            if (isAuthenticated) {\n                this.authenticatedResolvers[0]();\n                this.emit(this.Event.connect);\n                this.sendFromQueue();\n            } else {\n                this.authenticatedResolvers[1](envelope.data);\n            }\n        }\n    }\n\n    private onClose(event: CloseEvent): void {\n        clearTimeout(this.connectingTimeoutId);\n        const reconnect = event.code !== 1000; // Connection was closed because of error\n        if (reconnect) {\n            this.connect();\n        }\n        this.emit(this.Event.disconnect, reconnect);\n    }\n\n    private sendFromQueue(): void {\n        // Send awaiting data to server\n        let lastDelay = 0;\n        for (const dataIndex in this.sendQueue) {\n            const data = this.sendQueue[dataIndex];\n            setTimeout(() => this.send(...data), lastDelay);\n            lastDelay += this.options.awaitQueueSendDelayMs ?? 500;\n        }\n        this.sendQueue = [];\n        clearTimeout(this.connectingTimeoutId);\n    }\n\n    private triggerConnectionTimeout(): void {\n        this.disconnect();\n        this.emit(this.Event.error, new Error('Connection timeout'));\n    }\n}","import {AbstractChatClient, CommandResult, CommandsMap} from \"./AbstractChatClient\";\nimport {ObservableInterface} from \"./EventTarget\";\nimport {Envelope} from \"./types/src\";\n\nexport interface WebApiChatClientOptions {\n    url: string;\n    token?: string;\n    temporaryNick?: string;\n    attemptsToSend?: number;\n    attemptDelayMs?: number;\n}\n\nenum WebApiChatClientEvent {\n    message = 'message',\n    error = 'error',\n    destroy = 'destroy',\n}\n\nexport class WebApiChatClient extends AbstractChatClient implements ObservableInterface {\n    public readonly Event = WebApiChatClientEvent;\n\n    protected sendStack: {data: any, attempts: number, lastTimeoutId: any}[];\n\n    public constructor(private readonly options: WebApiChatClientOptions) {\n        super();\n        if (!this.options.token && !this.options.temporaryNick) {\n            throw new Error('Token or temporary nick is required');\n        }\n    }\n\n    public async send<CommandType extends keyof CommandsMap>(commandType: CommandType, commandData: CommandsMap[CommandType][0]):\n        Promise<CommandResult<CommandsMap[CommandType][1]>> {\n        const envelope = this.createEnvelope(commandType, commandData);\n        this.sendStack.push({data: envelope, attempts: 0, lastTimeoutId: null});\n        this.makeApiCall(this.sendStack.length - 1);\n        return this.createPromiseFromCommandEnvelope(envelope);\n    }\n\n    public destroy(): void {\n        // Cancel all awaiting requests\n        this.sendStack.forEach(item => {\n            if (item.lastTimeoutId) {\n                clearTimeout(item.lastTimeoutId);\n            }\n            this.awaitingResponse.delete(item.data.ref);\n        });\n        this.sendStack = [];\n        this.emit(this.Event.destroy, false);\n    }\n\n    protected async onMessage(reqId: number, response: Response): Promise<void> {\n        this.sendStack.splice(reqId, 1);\n        const envelope: Envelope = await response.json();\n        this.handleIncomingEnvelope(envelope);\n        this.emit(envelope.type, envelope.data);\n        this.emit(this.Event.message, envelope);\n    }\n\n    protected onError(reqId: number, body: string): void {\n        if (this.sendStack[reqId].attempts >= (this.options.attemptsToSend ?? 10)) {\n            this.sendStack.splice(reqId, 1);\n            this.handleEnvelopeSendError(this.sendStack[reqId].data, new Error(\n                `Cannot send ${body}; aborting after reaching the maximum connection errors`\n            ));\n            return;\n        }\n        this.sendStack[reqId].lastTimeoutId = setTimeout(\n            () => this.makeApiCall(reqId),\n            this.options.attemptDelayMs ?? 3000\n        );\n    }\n\n    protected makeApiCall(reqId: number): void {\n        this.sendStack[reqId].attempts++;\n        const bodyJson = JSON.stringify(this.sendStack[reqId].data);\n        const headers: any = {\n            'Content-Type': 'application/json',\n            Accept: 'application/json'\n        };\n\n        if (this.options.token) {\n            headers.Authorization = `Bearer ${this.options.token}`;\n        } else if (this.options.temporaryNick) {\n            headers.Authorization = `Temp ${this.options.temporaryNick}`;\n        }\n\n        fetch(this.options.url, {\n            headers,\n            body: bodyJson,\n            method: 'POST',\n        })\n            .then(response => this.onMessage(reqId, response))\n            .catch(() => this.onError(reqId, bodyJson));\n    }\n}","export interface RestClientOptions {\r\n    url?: string;\r\n    token: string;\r\n}\r\n\r\nexport interface RestClientResponse<T> {\r\n    ok: boolean;\r\n    status: number;\r\n    data: T;\r\n}\r\n\r\nexport type HttpMethod = 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE';\r\n\r\nexport abstract class AbstractRestClient {\r\n    protected abstract defaultUrl: string;\r\n\r\n    public constructor(\r\n        private readonly options: RestClientOptions,\r\n    ) {}\r\n\r\n    protected async send<ResponseT = any>(\r\n        method: HttpMethod,\r\n        uri: string,\r\n        data: any = undefined\r\n    ): Promise<RestClientResponse<ResponseT>> {\r\n        const headers: any = {\r\n            'Content-Type': 'application/json',\r\n            Accept: 'application/json'\r\n        };\r\n\r\n        if (this.options.token) {\r\n            headers.Authorization = `Bearer ${this.options.token}`;\r\n        }\r\n\r\n        let url = this.getUrl(uri);\r\n        let body = undefined;\r\n\r\n        if (data) {\r\n            if (['GET', 'DELETE'].includes(method)) {\r\n                url += new URLSearchParams(data).toString()\r\n            } else {\r\n                body = JSON.stringify(data);\r\n            }\r\n        }\r\n\r\n        const result = await fetch(url, {method, body, headers});\r\n\r\n        return {\r\n            ok: result.ok,\r\n            status: result.status,\r\n            data: result.headers.get('content-type')?.includes('json') ? await result.json() : await result.text(),\r\n        };\r\n    }\r\n\r\n    protected getUrl(uri: string): string {\r\n        return this.removeEndingSlash(this.options.url ?? this.defaultUrl) + '/' + this.removeStartingSlash(uri);\r\n    }\r\n\r\n    private removeStartingSlash(text: string): string {\r\n        return text.replace(/^\\/+/, '');\r\n    }\r\n\r\n    private removeEndingSlash(text: string): string {\r\n        return text.replace(/\\/+$/, '');\r\n    }\r\n}","import {AbstractRestClient} from \"./AbstractRestClient\";\n\nexport interface TokenInterface {\n    token: string,\n    expiration: string\n}\n\nexport interface MyAccountInterface {\n    id: string;\n    nick: string;\n    avatar: string;\n}\n\nexport class AuthClient extends AbstractRestClient {\n    protected defaultUrl: string = 'https://polfan.pl/webservice/api';\n\n    public static async createToken(\n        login: string,\n        password: string,\n        clientName: string = 'pserv-js-client'\n    ): Promise<TokenInterface> {\n        const response = await new AuthClient({token: null}).send('POST', 'auth/tokens', {\n            login, password, client_name: clientName\n        });\n        if (response.ok) {\n            return response.data;\n        }\n        throw new Error(`Cannot create user token: ${response.data.errors[0]}`);\n    }\n\n    public async deleteToken(token: string): Promise<void> {\n        const response = await this.send('DELETE', `auth/tokens/${token}`);\n        if (!response.ok) {\n            throw new Error(`Cannot delete access token: ${response.data.errors[0]}`);\n        }\n    }\n\n    public async getMe(): Promise<MyAccountInterface> {\n        const response = await this.send('GET', 'auth/me');\n        if (response.ok) {\n            response.data.id = response.data.id.toString();\n            return response.data;\n        }\n        throw new Error(`Cannot get current user account: ${response.data.errors[0]}`);\n    }\n}","import {WebSocketChatClient} from \"./WebSocketChatClient\";\nimport {WebApiChatClient} from \"./WebApiChatClient\";\nimport {\n    IndexedCollection,\n    IndexedObjectCollection,\n    ObservableIndexedCollection,\n    ObservableIndexedObjectCollection\n} from \"./IndexedObjectCollection\";\nimport { AuthClient } from \"./AuthClient\";\nimport { Permissions, PermissionDefinition, Layer } from \"./Permissions\";\nimport * as ChatTypes from './types/src';\n\nexport {\n    IndexedCollection, ObservableIndexedCollection,\n    IndexedObjectCollection, ObservableIndexedObjectCollection,\n    Permissions, PermissionDefinition, Layer,\n    WebSocketChatClient, WebApiChatClient,\n    AuthClient,\n};\n\nexport type {ChatTypes};"],"names":["EventTarget","Map","eventName","handler","addHandler","events","onceEvents","index","get","indexOf","splice","event","callHandlers","map","handlers","push","set","forEach","callback","AbstractChatClient","type","data","ref","sentCounter","toString","envelope","Promise","args","awaitingResponse","has","isError","error","IndexedCollection","items","_items","size","item","id","ids","clear","field","valueToFind","limit","result","entries","next","value","done","length","Array","from","entry","IndexedObjectCollection","values","getId","deleteAll","ObservableIndexedCollection","eventTarget","emit","setItems","deletedItems","keys","on","once","off","ObservableIndexedObjectCollection","DeferredTask","promise","resolve","PromiseRegistry","key","promises","fn","register","getCombinedId","location","roomId","topicId","MessagesManager","tracker","client","ev","handleSession","handleRoomJoin","handleNewTopic","handleFollowedTopicUpdated","handleTopicFollowed","handleTopicUnfollowed","handleNewMessage","handleRoomDeleted","handleRoomLeft","handleTopicDeleted","list","spaceId","spaces","Error","send","setFollowedTopicsArray","followedTopics","rooms","undefined","topicIds","newTopics","newTopic","newTopicCombinedId","messageRef","refTopicCombinedId","refTopicMessages","refMessage","messageId","topicRef","message","updateLocallyFollowedTopicOnNewMessage","followedTopic","room","defaultTopic","createHistoryForNewTopic","topic","state","roomFollowedTopics","isMe","author","me","update","missed","missedMoreThan","lastAckMessageId","roomToTopics","report","RoomsManager","messages","handleRoomJoined","handleRoomUpdated","handleRoomMemberJoined","handleRoomMemberLeft","handleRoomMembers","handleRoomMemberUpdated","handleSpaceMemberLeft","handleSpaceMemberUpdated","handleSpaceDeleted","handleUserUpdated","membersPromises","notExist","registerByFunction","members","getMe","userId","getMembers","find","member","user","spaceMember","deferredSession","topics","roomIds","forget","_deleteByTopicIds","deleteRoom","findBy","roomMembers","roomMember","newMember","deleteRoomsBySpaceId","collection","addJoinedRoomTopics","addJoinedRooms","name","description","messageCount","lastMessage","reorderRolesOnPriorityUpdate","allRoles","oldRole","updatedRole","increased","priority","decreased","changedRoles","role","SpacesManager","handleNewRoom","handleSpaceUpdated","handleSpaceJoined","handleSpaceMemberJoined","handleSpaceMembers","handleSpaceRooms","handleNewRole","handleRoleDeleted","handleRoleUpdated","roles","roomsPromises","summary","roomIdToSpaceId","space","addJoinedSpaces","summaries","newRole","rolesToUpdate","Layer","PermissionDefinition","Permissions","Object","permissionName","layer","def","getByName","maxLayer","Root","Room","CreateSpaces","Global","ManageSpace","Space","ManageSpaceRoles","ManageRoom","CreateTopics","ManageTopic","Topic","ManageSpaceMembers","ManageRoomMembers","CreateMessages","ManagePermissions","CreateSpaceRooms","ManageSpaceRooms","getOvId","target","targetId","getOvIdByObject","overwrites","PermissionsManager","handlePermissionOverwrites","validateLocation","overwritesPromises","permissionNames","calculatePermissions","ownedPermissions","missing","ok","hasAll","hasAny","fetchMembersOrFail","userRoles","getOverwrites","then","v","filterLocation","collectRoleOverwrites","getTopics","all","resolveOverwritesHierarchy","deleteOverwritesByIdPrefix","prefix","startsWith","roleId","roleOverwrites","resolveOverwritesFromRolesByOrder","allows","denies","getRoles","sortedOverwrites","sort","a","b","permissionsLength","reduce","previousValue","currentValue","Math","max","allow","deny","overwriteEvent","revDecDenies","split","reverse","join","revDecAllows","i","parseInt","permissionOverwritesValues","getRootAccessValue","getNames","results","spaceFail","roomFail","ChatStateTracker","_me","WebSocketChatClientEvent","WebSocketChatClient","options","token","temporaryNick","stateTracking","authString","ws","WebSocket","url","onclose","onClose","onmessage","onMessage","connectingTimeoutId","setTimeout","triggerConnectionTimeout","connectingTimeoutMs","authenticated","authenticatedResolvers","sendQueue","close","commandType","commandData","CLOSED","CLOSING","includes","readyState","CONNECTING","OPEN","createEnvelope","JSON","stringify","createPromiseFromCommandEnvelope","parse","handleIncomingEnvelope","Event","isAuthenticated","connect","sendFromQueue","clearTimeout","reconnect","code","disconnect","lastDelay","dataIndex","awaitQueueSendDelayMs","WebApiChatClientEvent","WebApiChatClient","sendStack","attempts","lastTimeoutId","makeApiCall","destroy","reqId","response","json","body","attemptsToSend","handleEnvelopeSendError","attemptDelayMs","bodyJson","headers","Accept","Authorization","fetch","method","onError","AbstractRestClient","uri","getUrl","URLSearchParams","status","text","removeEndingSlash","defaultUrl","removeStartingSlash","replace","AuthClient","errors","login","password","clientName","client_name"],"sourceRoot":""}